<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Biological Insights & Analytics</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .section-title { margin-top: 30px; margin-bottom: 15px; }
        .insight-btn { margin: 10px 0; }
        .upload-label { font-weight: bold; }
    </style>
</head>
<body>
<div class="container mt-4">
    <h1>Biological Insights & Analytics</h1>
    <hr>
    <h3 class="section-title">Species Comparison</h3>
    <form id="species-comparison-form" enctype="multipart/form-data">
        <div class="form-group">
            <label class="upload-label">Upload DNA files for multiple species (at least 2):</label>
            <input type="file" class="form-control-file" name="species_files" id="species_files" multiple required>
        </div>
        <button type="button" class="btn btn-primary insight-btn" onclick="runSpeciesComparison()">Compare Species</button>
    </form>
    <div id="species-comparison-result"></div>
    <h3 class="section-title">K-mer Uniqueness Heatmap / Venn Diagram</h3>
    <button type="button" class="btn btn-success insight-btn" onclick="runKmerHeatmap()">Show K-mer Uniqueness Heatmap</button>
    <div id="kmer-heatmap-result"></div>
    <h3 class="section-title">GC Content & Motif Analysis</h3>
    <form id="motif-analysis-form" enctype="multipart/form-data">
        <div class="form-group">
            <label class="upload-label">Upload DNA file:</label>
            <input type="file" class="form-control-file" name="motif_file" id="motif_file" required>
        </div>
        <div class="form-group">
            <label>Motif (optional):</label>
            <input type="text" class="form-control" name="motif" id="motif" placeholder="e.g. ATG">
        </div>
        <button type="button" class="btn btn-warning insight-btn" onclick="runMotifAnalysis()">Analyze GC Content & Motif</button>
    </form>
    <div id="motif-analysis-result"></div>
    <a href="/" class="btn btn-secondary mt-4">Back to Main Page</a>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
// Placeholder JS functions for AJAX calls
function runSpeciesComparison() {
    var formData = new FormData($('#species-comparison-form')[0]);
    $.ajax({
        url: '/api/species-comparison',
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        success: function(response) {
            if (response.error) {
                $('#species-comparison-result').html('<div class="alert alert-danger">' + response.error + '</div>');
                return;
            }
            var summary = response.summary;
            // Side-by-side comparison table for two species
            if (summary.species.length === 2) {
                var a = summary.species[0], b = summary.species[1];
                var totalA = summary.total_kmers[a];
                var totalB = summary.total_kmers[b];
                var uniqueA = response.pairwise_overlap[a][a] - response.pairwise_overlap[a][b];
                var uniqueB = response.pairwise_overlap[b][b] - response.pairwise_overlap[b][a];
                var shared = response.pairwise_overlap[a][b];
                var jaccard = (response.pairwise_jaccard[a][b]).toFixed(4);
                var html = '<h5>Species Comparison</h5>';
                html += '<div class="table-responsive"><table class="table table-bordered table-striped"><thead><tr>';
                html += '<th>Metric</th><th>' + a + '</th><th>' + b + '</th></tr></thead><tbody>';
                html += '<tr><td><b>Total k-mers</b></td><td>' + totalA + '</td><td>' + totalB + '</td></tr>';
                html += '<tr><td><b>Unique k-mers</b></td><td>' + uniqueA + '</td><td>' + uniqueB + '</td></tr>';
                html += '<tr><td><b>Shared k-mers</b></td><td colspan="2">' + shared + '</td></tr>';
                html += '<tr><td><b>Jaccard Similarity</b></td><td colspan="2">' + jaccard + '</td></tr>';
                html += '</tbody></table></div>';
                $('#species-comparison-result').html(html);
            } else {
                $('#species-comparison-result').html('<div class="alert alert-info">Upload exactly 2 species files for direct comparison.</div>');
            }
            // TODO: Render venn diagram using response.venn_data
        },
        error: function(xhr) {
            $('#species-comparison-result').html('<div class="alert alert-danger">Error: ' + xhr.responseText + '</div>');
        }
    });
}
function runKmerHeatmap() {
    // TODO: Implement AJAX call to backend
    $('#kmer-heatmap-result').html('<div class="alert alert-info">K-mer uniqueness heatmap/venn diagram will appear here.</div>');
}
function runMotifAnalysis() {
    // TODO: Implement AJAX call to backend
    $('#motif-analysis-result').html('<div class="alert alert-info">GC content and motif analysis will appear here.</div>');
}
</script>
</body>
</html> 